{% from "forms.html" import render_form_field %}
{% extends 'base.html' %}


{% block page_title %}  {% endblock %}

{% block content %} 
<div class="grid-container single-wide">
    <div class="grid-item">
            <div class="title"><h1>ENTER NEW TEST RESULTS</h1></div>
            
            <form name="add_test" method="post" class="form">
                <div class="form__container">
                    {{ form.hidden_tag() }}
                    {{ form.hidden_tag(form.po4_ppm) }}

                    {{ render_form_field(form.test_date) }}
                    {{ render_form_field(form.test_time) }}
                    {{ render_form_field(form.alk) }}
                    {{ render_form_field(form.po4_ppb) }}
                    {{ render_form_field(form.no3_ppm) }}
                    {{ render_form_field(form.cal) }}
                    {{ render_form_field(form.mg) }}
                    {{ render_form_field(form.sg) }}
                     <div class="row">
                            <label class="form-label" for="tank_id">
                                {{ form.tank_id.label }}<span class="text-danger">*</span>
                            </label>
                            <select id="tank_id" name="tank_id" class="form-select" required style="pointer-events: none; background: #e9ecef;">
                                {% if tanks|length == 1 %}
                                    <option value="{{ tanks[0].id }}" selected>{{ tanks[0].name }}</option>
                                {% else %}
                                    {% for tank in tanks %}
                                        <option value="{{ tank.id }}" {% if tank.id == tank_id %}selected{% endif %}>{{ tank.name }}</option>
                                    {% endfor %}
                                {% endif %}
                            </select>
                        </div>
                    <div class="button-row">
                        {{ form.submit(class="btn btn-custom-1", id="submit-test") }}

                    </div>
                </div>
            </form>
            <script>
            // Prevent form reset when tank context changes (page reload)
            document.addEventListener('DOMContentLoaded', function() {
                if (window.performance && window.performance.navigation.type === window.performance.navigation.TYPE_RELOAD) {
                    if (window.history && window.history.replaceState) {
                        window.history.replaceState({}, document.title, window.location.pathname + window.location.search);
                    }
                }
            });
            </script>

    </div>
</div>

{% endblock %}